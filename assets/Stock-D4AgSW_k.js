import{u as ue,p as de,P as fe,a as pe,S as he}from"./index-K3AbctKA.js";import{d as oe,m as xe,c as se,r as m,a as D,i as U,w as M,b as V,e as X,u as ve,o as ge,n as L,f as O,g as me,h as ye,j as be,v as we,k as p,s as ke,l as ae,T as Se,p as Ie,q as z,t as re,x as Be,y as j,z as De,H as Pe,I as Ce,A as Te,B as y,C as Y,D as x,E as N,F as k,G as Ee,J as Me,K as Ve,L as H,M as je}from"./index-Bwe1OjNY.js";function G(e,t){return e.reduce((n,r)=>Math.abs(n-t)<Math.abs(r-t)?n:r)}const Ae={gap:{type:[Number,Object],default:24},icon:String,axis:xe("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[_e,J]=se("floating-bubble");var Le=oe({name:_e,inheritAttrs:!1,props:Ae,emits:["click","update:offset","offsetChange"],setup(e,{slots:t,emit:n,attrs:r}){const i=m(),s=m({x:0,y:0,width:0,height:0}),a=D(()=>U(e.gap)?e.gap.x:e.gap),c=D(()=>U(e.gap)?e.gap.y:e.gap),o=D(()=>({top:c.value,right:V.value-s.value.width-a.value,bottom:M.value-s.value.height-c.value,left:a.value})),h=m(!1);let I=!1;const C=D(()=>{const u={},w=X(s.value.x),f=X(s.value.y);return u.transform=`translate3d(${w}, ${f}, 0)`,(h.value||!I)&&(u.transition="none"),u}),l=()=>{if(!B.value)return;const{width:u,height:w}=Ie(i.value),{offset:f}=e;s.value={x:f?f.x:V.value-u-a.value,y:f?f.y:M.value-w-c.value,width:u,height:w}},d=ue();let g=0,S=0;const T=u=>{d.start(u),h.value=!0,g=s.value.x,S=s.value.y};ve("touchmove",u=>{if(u.preventDefault(),d.move(u),e.axis!=="lock"&&!d.isTap.value){if(e.axis==="x"||e.axis==="xy"){let f=g+d.deltaX.value;f<o.value.left&&(f=o.value.left),f>o.value.right&&(f=o.value.right),s.value.x=f}if(e.axis==="y"||e.axis==="xy"){let f=S+d.deltaY.value;f<o.value.top&&(f=o.value.top),f>o.value.bottom&&(f=o.value.bottom),s.value.y=f}const w=z(s.value,["x","y"]);n("update:offset",w)}},{target:i});const W=()=>{h.value=!1,L(()=>{if(e.magnetic==="x"){const u=G([o.value.left,o.value.right],s.value.x);s.value.x=u}if(e.magnetic==="y"){const u=G([o.value.top,o.value.bottom],s.value.y);s.value.y=u}if(!d.isTap.value){const u=z(s.value,["x","y"]);n("update:offset",u),(g!==u.x||S!==u.y)&&n("offsetChange",u)}})},le=u=>{d.isTap.value?n("click",u):u.stopPropagation()};ge(()=>{l(),L(()=>{I=!0})}),O([V,M,a,c,()=>e.offset],l,{deep:!0});const B=m(!0);return me(()=>{B.value=!0}),ye(()=>{e.teleport&&(B.value=!1)}),()=>{const u=be(p("div",ae({class:J(),ref:i,onTouchstartPassive:T,onTouchend:W,onTouchcancel:W,onClickCapture:le,style:C.value},r),[t.default?t.default():p(ke,{name:e.icon,class:J("icon")},null)]),[[we,B.value]]);return e.teleport?p(Se,{to:e.teleport},{default:()=>[u]}):u}}});const Oe=re(Le),ze=e=>e?.includes("/"),Ne=[...de,"round","closeOnPopstate","safeAreaInsetBottom"],$e={qq:"qq",link:"link-o",weibo:"weibo",qrcode:"qr",poster:"photo-o",wechat:"wechat","weapp-qrcode":"miniprogram-o","wechat-moments":"wechat-moments"},[Fe,v,Re]=se("share-sheet"),Ke=Be({},pe,{title:String,round:j,options:De(),cancelText:String,description:String,closeOnPopstate:j,safeAreaInsetBottom:j});var qe=oe({name:Fe,props:Ke,emits:["cancel","select","update:show"],setup(e,{emit:t,slots:n}){const r=l=>t("update:show",l),i=()=>{r(!1),t("cancel")},s=(l,d)=>t("select",l,d),a=()=>{const l=n.title?n.title():e.title,d=n.description?n.description():e.description;if(l||d)return p("div",{class:v("header")},[l&&p("h2",{class:v("title")},[l]),d&&p("span",{class:v("description")},[d])])},c=l=>ze(l)?p("img",{src:l,class:v("image-icon")},null):p("div",{class:v("icon",[l])},[p(Ce,{name:$e[l]||l},null)]),o=(l,d)=>{const{name:g,icon:S,className:T,description:E}=l;return p("div",{role:"button",tabindex:0,class:[v("option"),T,Pe],onClick:()=>s(l,d)},[c(S),g&&p("span",{class:v("name")},[g]),E&&p("span",{class:v("option-description")},[E])])},h=(l,d)=>p("div",{class:v("options",{border:d})},[l.map(o)]),I=()=>{const{options:l}=e;return Array.isArray(l[0])?l.map((d,g)=>h(d,g!==0)):h(l)},C=()=>{var l;const d=(l=e.cancelText)!=null?l:Re("cancel");if(n.cancel||d)return p("button",{type:"button",class:v("cancel"),onClick:i},[n.cancel?n.cancel():d])};return()=>p(fe,ae({class:v(),position:"bottom","onUpdate:show":r},z(e,Ne)),{default:()=>[a(),I(),C()]})}});const We=re(qe),$=(e,t)=>t.some(n=>e instanceof n);let Q,Z;function Ue(){return Q||(Q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xe(){return Z||(Z=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const F=new WeakMap,A=new WeakMap,P=new WeakMap;function Ye(e){const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{n(b(e.result)),i()},a=()=>{r(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",a)});return P.set(t,e),t}function He(e){if(F.has(e))return;const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});F.set(e,t)}let R={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return F.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return b(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ie(e){R=e(R)}function Ge(e){return Xe().includes(e)?function(...t){return e.apply(K(this),t),b(this.request)}:function(...t){return b(e.apply(K(this),t))}}function Je(e){return typeof e=="function"?Ge(e):(e instanceof IDBTransaction&&He(e),$(e,Ue())?new Proxy(e,R):e)}function b(e){if(e instanceof IDBRequest)return Ye(e);if(A.has(e))return A.get(e);const t=Je(e);return t!==e&&(A.set(e,t),P.set(t,e)),t}const K=e=>P.get(e);function Qe(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),c=b(a);return r&&a.addEventListener("upgradeneeded",o=>{r(b(a.result),o.oldVersion,o.newVersion,b(a.transaction),o)}),n&&a.addEventListener("blocked",o=>n(o.oldVersion,o.newVersion,o)),c.then(o=>{s&&o.addEventListener("close",()=>s()),i&&o.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Ze=["get","getKey","getAll","getAllKeys","count"],et=["put","add","delete","clear"],_=new Map;function ee(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(_.get(t))return _.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=et.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Ze.includes(n)))return;const s=async function(a,...c){const o=this.transaction(a,i?"readwrite":"readonly");let h=o.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[n](...c),i&&o.done]))[0]};return _.set(t,s),s}ie(e=>({...e,get:(t,n,r)=>ee(t,n)||e.get(t,n,r),has:(t,n)=>!!ee(t,n)||e.has(t,n)}));const tt=["continue","continuePrimaryKey","advance"],te={},q=new WeakMap,ce=new WeakMap,nt={get(e,t){if(!tt.includes(t))return e[t];let n=te[t];return n||(n=te[t]=function(...r){q.set(this,ce.get(this)[t](...r))}),n}};async function*ot(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,nt);for(ce.set(n,t),P.set(n,K(t));t;)yield n,t=await(q.get(n)||t.continue()),q.delete(n)}function ne(e,t){return t===Symbol.asyncIterator&&$(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&$(e,[IDBIndex,IDBObjectStore])}ie(e=>({...e,get(t,n,r){return ne(t,n)?ot:e.get(t,n,r)},has(t,n){return ne(t,n)||e.has(t,n)}}));const st=Qe("stock-db",1,{upgrade(e){e.objectStoreNames.contains("stocks")||e.createObjectStore("stocks",{keyPath:"id"})}});async function at(){const e=await st;if(await e.count("stocks")>0)return await e.getAll("stocks");{const r=await(await fetch("/stocks/stocks.json")).json(),i=e.transaction("stocks","readwrite"),s=i.objectStore("stocks");for(const a of r)await s.put(a);return await i.done,r}}const rt={key:0,style:{"margin-top":"12px"}},it={key:0},ct={style:{"font-size":"17px","font-weight":"bold",color:"#222","margin-right":"16px","min-width":"60px"}},lt={style:{"font-size":"16px",color:"#333",flex:"1"}},ut={key:1,style:{color:"#999","text-align":"center","margin-top":"16px"}},dt={__name:"StockSearchSheet",props:{modelValue:Boolean},setup(e){const t=e,n=m(),r=m(""),i=m([]);O(()=>t.modelValue,a=>{a&&L(()=>{const c=n.value?.$el?.querySelector("input");c&&c.focus()})}),O(()=>r.value,async a=>{if(!a||a.length<1){i.value=[];return}const c=await at();console.log("allStocks",c),i.value=c.filter(o=>o.name.includes(a)||o.id.includes(a)),console.log("searchResults",i.value)});function s(a){}return(a,c)=>(y(),Te(N(We),{show:t.modelValue,"onUpdate:show":c[1]||(c[1]=o=>a.$emit("update:modelValue",o)),options:[],"cancel-text":"",style:{"--van-share-sheet-header-padding":"24px 24px 0 24px","min-height":"60vh"}},{title:Y(()=>c[2]||(c[2]=[x("div",{style:{"font-size":"18px","font-weight":"bold","letter-spacing":"1px","text-align":"center","margin-top":"0","margin-bottom":"0",color:"#222","line-height":"1.2"}}," 股票搜尋 ",-1)])),description:Y(()=>[x("div",null,[p(N(he),{ref_key:"searchInputRef",ref:n,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=o=>r.value=o),placeholder:"請輸入股票名稱或代碼","action-text":"",style:{"--van-search-input-height":"48px","font-size":"18px"},onSearch:s},null,8,["modelValue"])]),x("div",null,[c[3]||(c[3]=x("div",{style:{display:"flex","align-items":"center",margin:"0 0 10px 0"}},[x("div",{style:{"margin-left":"16px","font-size":"16px",color:"#222","font-weight":"bold","letter-spacing":"1px"}}," | 熱門股票 ")],-1)),c[4]||(c[4]=x("div",{style:{display:"flex",gap:"8px","flex-wrap":"wrap","justify-content":"center","margin-bottom":"24px"}},[x("span",{style:{background:"#f2f3f5","border-radius":"16px",padding:"4px 12px","font-size":"15px"}},"台積電"),x("span",{style:{background:"#f2f3f5","border-radius":"16px",padding:"4px 12px","font-size":"15px"}},"鴻海"),x("span",{style:{background:"#f2f3f5","border-radius":"16px",padding:"4px 12px","font-size":"15px"}},"聯發科"),x("span",{style:{background:"#f2f3f5","border-radius":"16px",padding:"4px 12px","font-size":"15px"}},"長榮"),x("span",{style:{background:"#f2f3f5","border-radius":"16px",padding:"4px 12px","font-size":"15px"}},"中鋼")],-1)),r.value&&r.value.length>=1?(y(),k("div",rt,[i.value.length?(y(),k("div",it,[(y(!0),k(Me,null,Ve(i.value,o=>(y(),k("div",{key:o.id,style:{background:"#fff","border-radius":"12px","box-shadow":"0 2px 8px #0001",padding:"16px 20px","margin-bottom":"12px",display:"flex","align-items":"center","min-height":"56px"}},[x("div",ct,H(o.id),1),x("div",lt,H(o.name),1)]))),128))])):(y(),k("div",ut," 查無資料 "))])):Ee("",!0)])]),_:1},8,["show"]))}},ft={style:{padding:"32px"}},xt={__name:"Stock",setup(e){const t=m(!1);function n(){t.value=!0}return(r,i)=>(y(),k("div",ft,[i[1]||(i[1]=je(" 自選股頁面324234234234234234324234234234 ",-1)),p(N(Oe),{icon:"plus",axis:"xy",magnetic:"x",gap:{x:24,y:80},style:{"--van-floating-bubble-size":"48px"},onClick:n}),p(dt,{show:t.value,"onUpdate:show":i[0]||(i[0]=s=>t.value=s)},null,8,["show"])]))}};export{xt as default};
