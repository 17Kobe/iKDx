import{d as ae,m as he,c as re,r as w,a as C,i as X,w as M,b as j,e as Y,u as pe,o as ve,n as N,f as $,g as me,h as xe,j as ge,v as ye,k as h,s as be,l as ie,T as we,p as ke,q as z,t as ce,x as Se,y as A,z as Ie,H as Be,I as De,A as le,B as Ce,C as b,D as U,E as g,F as P,G as k,J as Pe,K as G,L as J,M as Te,N as L,O as _e}from"./index-BdSFO_S3.js";import{u as Ee,p as Me,P as je,a as Ae,S as Le}from"./index-sHkt-xuO.js";function Q(e,t){return e.reduce((n,i)=>Math.abs(n-t)<Math.abs(i-t)?n:i)}const Oe={gap:{type:[Number,Object],default:24},icon:String,axis:he("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[Ve,Z]=re("floating-bubble");var Ne=ae({name:Ve,inheritAttrs:!1,props:Oe,emits:["click","update:offset","offsetChange"],setup(e,{slots:t,emit:n,attrs:i}){const a=w(),s=w({x:0,y:0,width:0,height:0}),c=C(()=>X(e.gap)?e.gap.x:e.gap),p=C(()=>X(e.gap)?e.gap.y:e.gap),r=C(()=>({top:p.value,right:j.value-s.value.width-c.value,bottom:M.value-s.value.height-p.value,left:c.value})),v=w(!1);let d=!1;const m=C(()=>{const l={},I=Y(s.value.x),f=Y(s.value.y);return l.transform=`translate3d(${I}, ${f}, 0)`,(v.value||!d)&&(l.transition="none"),l}),o=()=>{if(!D.value)return;const{width:l,height:I}=ke(a.value),{offset:f}=e;s.value={x:f?f.x:j.value-l-c.value,y:f?f.y:M.value-I-p.value,width:l,height:I}},u=Ee();let y=0,B=0;const _=l=>{u.start(l),v.value=!0,y=s.value.x,B=s.value.y};pe("touchmove",l=>{if(l.preventDefault(),u.move(l),e.axis!=="lock"&&!u.isTap.value){if(e.axis==="x"||e.axis==="xy"){let f=y+u.deltaX.value;f<r.value.left&&(f=r.value.left),f>r.value.right&&(f=r.value.right),s.value.x=f}if(e.axis==="y"||e.axis==="xy"){let f=B+u.deltaY.value;f<r.value.top&&(f=r.value.top),f>r.value.bottom&&(f=r.value.bottom),s.value.y=f}const I=z(s.value,["x","y"]);n("update:offset",I)}},{target:a});const H=()=>{v.value=!1,N(()=>{if(e.magnetic==="x"){const l=Q([r.value.left,r.value.right],s.value.x);s.value.x=l}if(e.magnetic==="y"){const l=Q([r.value.top,r.value.bottom],s.value.y);s.value.y=l}if(!u.isTap.value){const l=z(s.value,["x","y"]);n("update:offset",l),(y!==l.x||B!==l.y)&&n("offsetChange",l)}})},fe=l=>{u.isTap.value?n("click",l):l.stopPropagation()};ve(()=>{o(),N(()=>{d=!0})}),$([j,M,c,p,()=>e.offset],o,{deep:!0});const D=w(!0);return me(()=>{D.value=!0}),xe(()=>{e.teleport&&(D.value=!1)}),()=>{const l=ge(h("div",ie({class:Z(),ref:a,onTouchstartPassive:_,onTouchend:H,onTouchcancel:H,onClickCapture:fe,style:m.value},i),[t.default?t.default():h(be,{name:e.icon,class:Z("icon")},null)]),[[ye,D.value]]);return e.teleport?h(we,{to:e.teleport},{default:()=>[l]}):l}}});const $e=ce(Ne),ze=e=>e?.includes("/"),Fe=[...Me,"round","closeOnPopstate","safeAreaInsetBottom"],Re={qq:"qq",link:"link-o",weibo:"weibo",qrcode:"qr",poster:"photo-o",wechat:"wechat","weapp-qrcode":"miniprogram-o","wechat-moments":"wechat-moments"},[Ke,x,We]=re("share-sheet"),qe=Se({},Ae,{title:String,round:A,options:Ie(),cancelText:String,description:String,closeOnPopstate:A,safeAreaInsetBottom:A});var He=ae({name:Ke,props:qe,emits:["cancel","select","update:show"],setup(e,{emit:t,slots:n}){const i=o=>t("update:show",o),a=()=>{i(!1),t("cancel")},s=(o,u)=>t("select",o,u),c=()=>{const o=n.title?n.title():e.title,u=n.description?n.description():e.description;if(o||u)return h("div",{class:x("header")},[o&&h("h2",{class:x("title")},[o]),u&&h("span",{class:x("description")},[u])])},p=o=>ze(o)?h("img",{src:o,class:x("image-icon")},null):h("div",{class:x("icon",[o])},[h(De,{name:Re[o]||o},null)]),r=(o,u)=>{const{name:y,icon:B,className:_,description:E}=o;return h("div",{role:"button",tabindex:0,class:[x("option"),_,Be],onClick:()=>s(o,u)},[p(B),y&&h("span",{class:x("name")},[y]),E&&h("span",{class:x("option-description")},[E])])},v=(o,u)=>h("div",{class:x("options",{border:u})},[o.map(r)]),d=()=>{const{options:o}=e;return Array.isArray(o[0])?o.map((u,y)=>v(u,y!==0)):v(o)},m=()=>{var o;const u=(o=e.cancelText)!=null?o:We("cancel");if(n.cancel||u)return h("button",{type:"button",class:x("cancel"),onClick:a},[n.cancel?n.cancel():u])};return()=>h(je,ie({class:x(),position:"bottom","onUpdate:show":i},z(e,Fe)),{default:()=>[c(),d(),m()]})}});const Xe=ce(He),F=(e,t)=>t.some(n=>e instanceof n);let ee,te;function Ye(){return ee||(ee=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ue(){return te||(te=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R=new WeakMap,O=new WeakMap,T=new WeakMap;function Ge(e){const t=new Promise((n,i)=>{const a=()=>{e.removeEventListener("success",s),e.removeEventListener("error",c)},s=()=>{n(S(e.result)),a()},c=()=>{i(e.error),a()};e.addEventListener("success",s),e.addEventListener("error",c)});return T.set(t,e),t}function Je(e){if(R.has(e))return;const t=new Promise((n,i)=>{const a=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",c),e.removeEventListener("abort",c)},s=()=>{n(),a()},c=()=>{i(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",s),e.addEventListener("error",c),e.addEventListener("abort",c)});R.set(e,t)}let K={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return R.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ue(e){K=e(K)}function Qe(e){return Ue().includes(e)?function(...t){return e.apply(W(this),t),S(this.request)}:function(...t){return S(e.apply(W(this),t))}}function Ze(e){return typeof e=="function"?Qe(e):(e instanceof IDBTransaction&&Je(e),F(e,Ye())?new Proxy(e,K):e)}function S(e){if(e instanceof IDBRequest)return Ge(e);if(O.has(e))return O.get(e);const t=Ze(e);return t!==e&&(O.set(e,t),T.set(t,e)),t}const W=e=>T.get(e);function et(e,t,{blocked:n,upgrade:i,blocking:a,terminated:s}={}){const c=indexedDB.open(e,t),p=S(c);return i&&c.addEventListener("upgradeneeded",r=>{i(S(c.result),r.oldVersion,r.newVersion,S(c.transaction),r)}),n&&c.addEventListener("blocked",r=>n(r.oldVersion,r.newVersion,r)),p.then(r=>{s&&r.addEventListener("close",()=>s()),a&&r.addEventListener("versionchange",v=>a(v.oldVersion,v.newVersion,v))}).catch(()=>{}),p}const tt=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],V=new Map;function ne(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(V.get(t))return V.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,a=nt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(a||tt.includes(n)))return;const s=async function(c,...p){const r=this.transaction(c,a?"readwrite":"readonly");let v=r.store;return i&&(v=v.index(p.shift())),(await Promise.all([v[n](...p),a&&r.done]))[0]};return V.set(t,s),s}ue(e=>({...e,get:(t,n,i)=>ne(t,n)||e.get(t,n,i),has:(t,n)=>!!ne(t,n)||e.has(t,n)}));const ot=["continue","continuePrimaryKey","advance"],oe={},q=new WeakMap,de=new WeakMap,st={get(e,t){if(!ot.includes(t))return e[t];let n=oe[t];return n||(n=oe[t]=function(...i){q.set(this,de.get(this)[t](...i))}),n}};async function*at(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,st);for(de.set(n,t),T.set(n,W(t));t;)yield n,t=await(q.get(n)||t.continue()),q.delete(n)}function se(e,t){return t===Symbol.asyncIterator&&F(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&F(e,[IDBIndex,IDBObjectStore])}ue(e=>({...e,get(t,n,i){return se(t,n)?at:e.get(t,n,i)},has(t,n){return se(t,n)||e.has(t,n)}}));const rt=et("stock-db",1,{upgrade(e){e.objectStoreNames.contains("stocks")||e.createObjectStore("stocks",{keyPath:"id"})}});async function it(){const e=await rt;if(await e.count("stocks")>0)return await e.getAll("stocks");{const a=await(await fetch("/iKDx/"+"stocks/stocks.json")).json(),s=e.transaction("stocks","readwrite"),c=s.objectStore("stocks");for(const p of a)await c.put(p);return await s.done,a}}const ct={style:{display:"flex",gap:"8px","flex-wrap":"wrap","justify-content":"center","margin-bottom":"24px"}},lt=["onClick"],ut={key:0,style:{"margin-top":"12px"}},dt={key:0},ft={style:{"font-size":"17px","font-weight":"bold",color:"#222","margin-right":"16px","min-width":"60px"}},ht={style:{"font-size":"16px",color:"#333",flex:"1"}},pt={key:1,style:{color:"#999","text-align":"center","margin-top":"16px"}},vt={__name:"StockSearch",setup(e){const t=le("stock-search"),n=w(!1);t.on(d=>{n.value=d});const i=w(),a=w(""),s=w([]),c=["台積電","鴻海","聯發科","長榮","中鋼"];function p(){N(()=>{const d=i.value?.$el?.querySelector("input");d&&d.focus()})}$(()=>n.value,d=>{d&&setTimeout(()=>{p()},300)}),$(()=>a.value,async d=>{if(!d||d.length<1){s.value=[];return}const m=await it();s.value=m.filter(o=>o.name.includes(d)||o.id.includes(d))});function r(d){}function v(d){a.value=d,p()}return(d,m)=>(b(),Ce(P(Xe),{show:n.value,"onUpdate:show":m[1]||(m[1]=o=>P(t).emit(!1)),options:[],"cancel-text":"",style:{"--van-share-sheet-header-padding":"24px 24px 0 24px","min-height":"80vh",height:"80vh"}},{title:U(()=>m[2]||(m[2]=[g("div",{style:{"font-size":"18px","font-weight":"bold","letter-spacing":"1px","text-align":"center","margin-top":"0","margin-bottom":"0",color:"#222","line-height":"1.2"}}," 股票搜尋 ",-1)])),description:U(()=>[g("div",null,[h(P(Le),{ref_key:"searchInputRef",ref:i,modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=o=>a.value=o),placeholder:"請輸入股票名稱或代碼","action-text":"",style:{"--van-search-input-height":"48px","font-size":"18px"},onSearch:r},null,8,["modelValue"])]),g("div",null,[m[3]||(m[3]=g("div",{style:{display:"flex","align-items":"center",margin:"0 0 10px 0"}},[g("div",{style:{"margin-left":"16px","font-size":"16px",color:"#222","font-weight":"bold","letter-spacing":"1px"}}," | 熱門股票 ")],-1)),g("div",ct,[(b(),k(G,null,J(c,o=>g("span",{key:o,onClick:u=>v(o),style:Te({background:a.value===o?"#1976d2":"#e3eafc",color:a.value===o?"#fff":"#1976d2",borderRadius:"16px",padding:"4px 12px",fontSize:"15px",cursor:"pointer",userSelect:"none",fontWeight:a.value===o?"bold":"normal",boxShadow:a.value===o?"0 0 0 2px #1976d233":"none",transition:"background 0.2s, color 0.2s"})},L(o),13,lt)),64))]),a.value&&a.value.length>=1?(b(),k("div",ut,[s.value.length?(b(),k("div",dt,[(b(!0),k(G,null,J(s.value,o=>(b(),k("div",{key:o.id,style:{background:"#fff","border-radius":"12px","box-shadow":"0 2px 8px #0001",padding:"16px 20px","margin-bottom":"12px",display:"flex","align-items":"center","min-height":"56px"}},[g("div",ft,L(o.id),1),g("div",ht,L(o.name),1)]))),128))])):(b(),k("div",pt," 查無資料 "))])):Pe("",!0)])]),_:1},8,["show"]))}},mt={style:{padding:"32px"}},yt={__name:"Stock",setup(e){const t=le("stock-search");function n(){t.emit(!0)}return(i,a)=>(b(),k("div",mt,[a[0]||(a[0]=_e(" 自選股頁面324234234234234234324234234234 ",-1)),h(P($e),{icon:"plus",axis:"xy",magnetic:"x",gap:{x:24,y:80},style:{"--van-floating-bubble-size":"48px"},onClick:n}),h(vt)]))}};export{yt as default};
