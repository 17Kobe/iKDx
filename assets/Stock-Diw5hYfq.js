import{d as ae,m as he,c as re,r as b,a as C,i as X,w as j,b as A,e as Y,u as pe,o as ve,n as _,f as N,g as me,h as xe,j as ye,v as ge,k as h,s as be,l as ie,T as we,p as ke,q as z,t as ce,x as Se,y as L,z as Ie,H as Be,I as De,A as le,B as Ce,C as g,D as U,E as y,F as P,G as w,J as Pe,K as G,L as J,M as _e,N as O,O as Te}from"./index-N2CH-93R.js";import{u as Ee,p as Me,P as je,a as Ae,S as Le}from"./index-DQrnG5t7.js";function Q(e,t){return e.reduce((n,c)=>Math.abs(n-t)<Math.abs(c-t)?n:c)}const Oe={gap:{type:[Number,Object],default:24},icon:String,axis:he("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[Ve,Z]=re("floating-bubble");var $e=ae({name:Ve,inheritAttrs:!1,props:Oe,emits:["click","update:offset","offsetChange"],setup(e,{slots:t,emit:n,attrs:c}){const r=b(),a=b({x:0,y:0,width:0,height:0}),l=C(()=>X(e.gap)?e.gap.x:e.gap),p=C(()=>X(e.gap)?e.gap.y:e.gap),i=C(()=>({top:p.value,right:A.value-a.value.width-l.value,bottom:j.value-a.value.height-p.value,left:l.value})),v=b(!1);let S=!1;const d=C(()=>{const u={},I=Y(a.value.x),f=Y(a.value.y);return u.transform=`translate3d(${I}, ${f}, 0)`,(v.value||!S)&&(u.transition="none"),u}),s=()=>{if(!D.value)return;const{width:u,height:I}=ke(r.value),{offset:f}=e;a.value={x:f?f.x:A.value-u-l.value,y:f?f.y:j.value-I-p.value,width:u,height:I}},o=Ee();let x=0,B=0;const E=u=>{o.start(u),v.value=!0,x=a.value.x,B=a.value.y};pe("touchmove",u=>{if(u.preventDefault(),o.move(u),e.axis!=="lock"&&!o.isTap.value){if(e.axis==="x"||e.axis==="xy"){let f=x+o.deltaX.value;f<i.value.left&&(f=i.value.left),f>i.value.right&&(f=i.value.right),a.value.x=f}if(e.axis==="y"||e.axis==="xy"){let f=B+o.deltaY.value;f<i.value.top&&(f=i.value.top),f>i.value.bottom&&(f=i.value.bottom),a.value.y=f}const I=z(a.value,["x","y"]);n("update:offset",I)}},{target:r});const H=()=>{v.value=!1,_(()=>{if(e.magnetic==="x"){const u=Q([i.value.left,i.value.right],a.value.x);a.value.x=u}if(e.magnetic==="y"){const u=Q([i.value.top,i.value.bottom],a.value.y);a.value.y=u}if(!o.isTap.value){const u=z(a.value,["x","y"]);n("update:offset",u),(x!==u.x||B!==u.y)&&n("offsetChange",u)}})},fe=u=>{o.isTap.value?n("click",u):u.stopPropagation()};ve(()=>{s(),_(()=>{S=!0})}),N([A,j,l,p,()=>e.offset],s,{deep:!0});const D=b(!0);return me(()=>{D.value=!0}),xe(()=>{e.teleport&&(D.value=!1)}),()=>{const u=ye(h("div",ie({class:Z(),ref:r,onTouchstartPassive:E,onTouchend:H,onTouchcancel:H,onClickCapture:fe,style:d.value},c),[t.default?t.default():h(be,{name:e.icon,class:Z("icon")},null)]),[[ge,D.value]]);return e.teleport?h(we,{to:e.teleport},{default:()=>[u]}):u}}});const Ne=ce($e),ze=e=>e?.includes("/"),Fe=[...Me,"round","closeOnPopstate","safeAreaInsetBottom"],Re={qq:"qq",link:"link-o",weibo:"weibo",qrcode:"qr",poster:"photo-o",wechat:"wechat","weapp-qrcode":"miniprogram-o","wechat-moments":"wechat-moments"},[Ke,m,qe]=re("share-sheet"),We=Se({},Ae,{title:String,round:L,options:Ie(),cancelText:String,description:String,closeOnPopstate:L,safeAreaInsetBottom:L});var He=ae({name:Ke,props:We,emits:["cancel","select","update:show"],setup(e,{emit:t,slots:n}){const c=s=>t("update:show",s),r=()=>{c(!1),t("cancel")},a=(s,o)=>t("select",s,o),l=()=>{const s=n.title?n.title():e.title,o=n.description?n.description():e.description;if(s||o)return h("div",{class:m("header")},[s&&h("h2",{class:m("title")},[s]),o&&h("span",{class:m("description")},[o])])},p=s=>ze(s)?h("img",{src:s,class:m("image-icon")},null):h("div",{class:m("icon",[s])},[h(De,{name:Re[s]||s},null)]),i=(s,o)=>{const{name:x,icon:B,className:E,description:M}=s;return h("div",{role:"button",tabindex:0,class:[m("option"),E,Be],onClick:()=>a(s,o)},[p(B),x&&h("span",{class:m("name")},[x]),M&&h("span",{class:m("option-description")},[M])])},v=(s,o)=>h("div",{class:m("options",{border:o})},[s.map(i)]),S=()=>{const{options:s}=e;return Array.isArray(s[0])?s.map((o,x)=>v(o,x!==0)):v(s)},d=()=>{var s;const o=(s=e.cancelText)!=null?s:qe("cancel");if(n.cancel||o)return h("button",{type:"button",class:m("cancel"),onClick:r},[n.cancel?n.cancel():o])};return()=>h(je,ie({class:m(),position:"bottom","onUpdate:show":c},z(e,Fe)),{default:()=>[l(),S(),d()]})}});const Xe=ce(He),F=(e,t)=>t.some(n=>e instanceof n);let ee,te;function Ye(){return ee||(ee=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ue(){return te||(te=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R=new WeakMap,V=new WeakMap,T=new WeakMap;function Ge(e){const t=new Promise((n,c)=>{const r=()=>{e.removeEventListener("success",a),e.removeEventListener("error",l)},a=()=>{n(k(e.result)),r()},l=()=>{c(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",l)});return T.set(t,e),t}function Je(e){if(R.has(e))return;const t=new Promise((n,c)=>{const r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",l),e.removeEventListener("abort",l)},a=()=>{n(),r()},l=()=>{c(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",l),e.addEventListener("abort",l)});R.set(e,t)}let K={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return R.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return k(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ue(e){K=e(K)}function Qe(e){return Ue().includes(e)?function(...t){return e.apply(q(this),t),k(this.request)}:function(...t){return k(e.apply(q(this),t))}}function Ze(e){return typeof e=="function"?Qe(e):(e instanceof IDBTransaction&&Je(e),F(e,Ye())?new Proxy(e,K):e)}function k(e){if(e instanceof IDBRequest)return Ge(e);if(V.has(e))return V.get(e);const t=Ze(e);return t!==e&&(V.set(e,t),T.set(t,e)),t}const q=e=>T.get(e);function et(e,t,{blocked:n,upgrade:c,blocking:r,terminated:a}={}){const l=indexedDB.open(e,t),p=k(l);return c&&l.addEventListener("upgradeneeded",i=>{c(k(l.result),i.oldVersion,i.newVersion,k(l.transaction),i)}),n&&l.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),p.then(i=>{a&&i.addEventListener("close",()=>a()),r&&i.addEventListener("versionchange",v=>r(v.oldVersion,v.newVersion,v))}).catch(()=>{}),p}const tt=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],$=new Map;function ne(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if($.get(t))return $.get(t);const n=t.replace(/FromIndex$/,""),c=t!==n,r=nt.includes(n);if(!(n in(c?IDBIndex:IDBObjectStore).prototype)||!(r||tt.includes(n)))return;const a=async function(l,...p){const i=this.transaction(l,r?"readwrite":"readonly");let v=i.store;return c&&(v=v.index(p.shift())),(await Promise.all([v[n](...p),r&&i.done]))[0]};return $.set(t,a),a}ue(e=>({...e,get:(t,n,c)=>ne(t,n)||e.get(t,n,c),has:(t,n)=>!!ne(t,n)||e.has(t,n)}));const ot=["continue","continuePrimaryKey","advance"],oe={},W=new WeakMap,de=new WeakMap,st={get(e,t){if(!ot.includes(t))return e[t];let n=oe[t];return n||(n=oe[t]=function(...c){W.set(this,de.get(this)[t](...c))}),n}};async function*at(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,st);for(de.set(n,t),T.set(n,q(t));t;)yield n,t=await(W.get(n)||t.continue()),W.delete(n)}function se(e,t){return t===Symbol.asyncIterator&&F(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&F(e,[IDBIndex,IDBObjectStore])}ue(e=>({...e,get(t,n,c){return se(t,n)?at:e.get(t,n,c)},has(t,n){return se(t,n)||e.has(t,n)}}));const rt=et("stock-db",1,{upgrade(e){e.objectStoreNames.contains("stocks")||e.createObjectStore("stocks",{keyPath:"id"})}});async function it(){const e=await rt;if(await e.count("stocks")>0)return await e.getAll("stocks");{const r=await(await fetch("/iKDx/"+"stocks/stocks.json")).json(),a=e.transaction("stocks","readwrite"),l=a.objectStore("stocks");for(const p of r)await l.put(p);return await a.done,r}}const ct={style:{display:"flex",gap:"8px","flex-wrap":"wrap","justify-content":"center","margin-bottom":"24px"}},lt=["onClick"],ut={key:0,style:{"margin-top":"12px"}},dt={key:0},ft={style:{"font-size":"17px","font-weight":"bold",color:"#222","margin-right":"16px","min-width":"60px"}},ht={style:{"font-size":"16px",color:"#333",flex:"1"}},pt={key:1,style:{color:"#999","text-align":"center","margin-top":"16px"}},vt={__name:"StockSearch",setup(e){const t=le("stock-search"),n=b(!1);t.on(d=>{n.value=d});const c=b(),r=b(""),a=b([]),l=["台積電","鴻海","聯發科","長榮","中鋼"];function p(){_(()=>{const d=c.value?.$el?.querySelector("input");d&&d.focus()})}function i(){_(()=>{const d=c.value?.$el?.querySelector("input");d&&d.blur(),typeof document<"u"&&document.activeElement&&document.activeElement.blur()})}N(()=>n.value,d=>{d?p():i()}),N(()=>r.value,async d=>{if(!d||d.length<1){a.value=[];return}const s=await it();a.value=s.filter(o=>o.name.includes(d)||o.id.includes(d))});function v(d){}function S(d){r.value=d,p()}return(d,s)=>(g(),Ce(P(Xe),{show:n.value,"onUpdate:show":s[1]||(s[1]=o=>P(t).emit(!1)),options:[],"cancel-text":"",style:{"--van-share-sheet-header-padding":"24px 24px 0 24px","min-height":"80vh",height:"80vh"}},{title:U(()=>s[2]||(s[2]=[y("div",{style:{"font-size":"18px","font-weight":"bold","letter-spacing":"1px","text-align":"center","margin-top":"0","margin-bottom":"0",color:"#222","line-height":"1.2"}}," 股票搜尋 ",-1)])),description:U(()=>[y("div",null,[h(P(Le),{ref_key:"searchInputRef",ref:c,modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=o=>r.value=o),placeholder:"請輸入股票名稱或代碼","action-text":"",style:{"--van-search-input-height":"48px","font-size":"18px"},onSearch:v},null,8,["modelValue"])]),y("div",null,[s[3]||(s[3]=y("div",{style:{display:"flex","align-items":"center",margin:"0 0 10px 0"}},[y("div",{style:{"margin-left":"16px","font-size":"16px",color:"#222","font-weight":"bold","letter-spacing":"1px"}}," | 熱門股票 ")],-1)),y("div",ct,[(g(),w(G,null,J(l,o=>y("span",{key:o,onClick:x=>S(o),style:_e({background:r.value===o?"#1976d2":"#e3eafc",color:r.value===o?"#fff":"#1976d2",borderRadius:"16px",padding:"4px 12px",fontSize:"15px",cursor:"pointer",userSelect:"none",fontWeight:r.value===o?"bold":"normal",boxShadow:r.value===o?"0 0 0 2px #1976d233":"none",transition:"background 0.2s, color 0.2s"})},O(o),13,lt)),64))]),r.value&&r.value.length>=1?(g(),w("div",ut,[a.value.length?(g(),w("div",dt,[(g(!0),w(G,null,J(a.value,o=>(g(),w("div",{key:o.id,style:{background:"#fff","border-radius":"12px","box-shadow":"0 2px 8px #0001",padding:"16px 20px","margin-bottom":"12px",display:"flex","align-items":"center","min-height":"56px"}},[y("div",ft,O(o.id),1),y("div",ht,O(o.name),1)]))),128))])):(g(),w("div",pt," 查無資料 "))])):Pe("",!0)])]),_:1},8,["show"]))}},mt={style:{padding:"32px"}},gt={__name:"Stock",setup(e){const t=le("stock-search");function n(){t.emit(!0)}return(c,r)=>(g(),w("div",mt,[r[0]||(r[0]=Te(" 自選股頁面324234234234234234324234234234 ",-1)),h(P(Ne),{icon:"plus",axis:"xy",magnetic:"x",gap:{x:24,y:80},style:{"--van-floating-bubble-size":"48px"},onClick:n}),h(vt)]))}};export{gt as default};
