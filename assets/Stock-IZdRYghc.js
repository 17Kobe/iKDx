import{d as ae,m as he,c as re,r as w,a as C,i as X,w as j,b as A,e as Y,u as pe,o as ve,n as _,f as N,g as me,h as xe,j as ge,v as ye,k as v,s as be,l as ie,T as we,p as ke,q as z,t as ce,x as Se,y as L,z as Ie,H as Be,I as De,A as le,B as Ce,C as b,D as U,E as g,F as P,G as k,J as Pe,K as G,L as J,M as _e,N as O,O as Te}from"./index-CX_6PQPN.js";import{u as Ee,p as Me,P as je,a as Ae,S as Le}from"./index-v5fkdJlk.js";function Q(e,t){return e.reduce((n,r)=>Math.abs(n-t)<Math.abs(r-t)?n:r)}const Oe={gap:{type:[Number,Object],default:24},icon:String,axis:he("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[Ve,Z]=re("floating-bubble");var $e=ae({name:Ve,inheritAttrs:!1,props:Oe,emits:["click","update:offset","offsetChange"],setup(e,{slots:t,emit:n,attrs:r}){const s=w(),o=w({x:0,y:0,width:0,height:0}),l=C(()=>X(e.gap)?e.gap.x:e.gap),m=C(()=>X(e.gap)?e.gap.y:e.gap),a=C(()=>({top:m.value,right:A.value-o.value.width-l.value,bottom:j.value-o.value.height-m.value,left:l.value})),c=w(!1);let f=!1;const h=C(()=>{const u={},I=Y(o.value.x),p=Y(o.value.y);return u.transform=`translate3d(${I}, ${p}, 0)`,(c.value||!f)&&(u.transition="none"),u}),i=()=>{if(!D.value)return;const{width:u,height:I}=ke(s.value),{offset:p}=e;o.value={x:p?p.x:A.value-u-l.value,y:p?p.y:j.value-I-m.value,width:u,height:I}},d=Ee();let y=0,B=0;const E=u=>{d.start(u),c.value=!0,y=o.value.x,B=o.value.y};pe("touchmove",u=>{if(u.preventDefault(),d.move(u),e.axis!=="lock"&&!d.isTap.value){if(e.axis==="x"||e.axis==="xy"){let p=y+d.deltaX.value;p<a.value.left&&(p=a.value.left),p>a.value.right&&(p=a.value.right),o.value.x=p}if(e.axis==="y"||e.axis==="xy"){let p=B+d.deltaY.value;p<a.value.top&&(p=a.value.top),p>a.value.bottom&&(p=a.value.bottom),o.value.y=p}const I=z(o.value,["x","y"]);n("update:offset",I)}},{target:s});const H=()=>{c.value=!1,_(()=>{if(e.magnetic==="x"){const u=Q([a.value.left,a.value.right],o.value.x);o.value.x=u}if(e.magnetic==="y"){const u=Q([a.value.top,a.value.bottom],o.value.y);o.value.y=u}if(!d.isTap.value){const u=z(o.value,["x","y"]);n("update:offset",u),(y!==u.x||B!==u.y)&&n("offsetChange",u)}})},fe=u=>{d.isTap.value?n("click",u):u.stopPropagation()};ve(()=>{i(),_(()=>{f=!0})}),N([A,j,l,m,()=>e.offset],i,{deep:!0});const D=w(!0);return me(()=>{D.value=!0}),xe(()=>{e.teleport&&(D.value=!1)}),()=>{const u=ge(v("div",ie({class:Z(),ref:s,onTouchstartPassive:E,onTouchend:H,onTouchcancel:H,onClickCapture:fe,style:h.value},r),[t.default?t.default():v(be,{name:e.icon,class:Z("icon")},null)]),[[ye,D.value]]);return e.teleport?v(we,{to:e.teleport},{default:()=>[u]}):u}}});const Ne=ce($e),ze=e=>e?.includes("/"),Fe=[...Me,"round","closeOnPopstate","safeAreaInsetBottom"],Re={qq:"qq",link:"link-o",weibo:"weibo",qrcode:"qr",poster:"photo-o",wechat:"wechat","weapp-qrcode":"miniprogram-o","wechat-moments":"wechat-moments"},[Ke,x,qe]=re("share-sheet"),We=Se({},Ae,{title:String,round:L,options:Ie(),cancelText:String,description:String,closeOnPopstate:L,safeAreaInsetBottom:L});var He=ae({name:Ke,props:We,emits:["cancel","select","update:show"],setup(e,{emit:t,slots:n}){const r=i=>t("update:show",i),s=()=>{r(!1),t("cancel")},o=(i,d)=>t("select",i,d),l=()=>{const i=n.title?n.title():e.title,d=n.description?n.description():e.description;if(i||d)return v("div",{class:x("header")},[i&&v("h2",{class:x("title")},[i]),d&&v("span",{class:x("description")},[d])])},m=i=>ze(i)?v("img",{src:i,class:x("image-icon")},null):v("div",{class:x("icon",[i])},[v(De,{name:Re[i]||i},null)]),a=(i,d)=>{const{name:y,icon:B,className:E,description:M}=i;return v("div",{role:"button",tabindex:0,class:[x("option"),E,Be],onClick:()=>o(i,d)},[m(B),y&&v("span",{class:x("name")},[y]),M&&v("span",{class:x("option-description")},[M])])},c=(i,d)=>v("div",{class:x("options",{border:d})},[i.map(a)]),f=()=>{const{options:i}=e;return Array.isArray(i[0])?i.map((d,y)=>c(d,y!==0)):c(i)},h=()=>{var i;const d=(i=e.cancelText)!=null?i:qe("cancel");if(n.cancel||d)return v("button",{type:"button",class:x("cancel"),onClick:s},[n.cancel?n.cancel():d])};return()=>v(je,ie({class:x(),position:"bottom","onUpdate:show":r},z(e,Fe)),{default:()=>[l(),f(),h()]})}});const Xe=ce(He),F=(e,t)=>t.some(n=>e instanceof n);let ee,te;function Ye(){return ee||(ee=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ue(){return te||(te=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R=new WeakMap,V=new WeakMap,T=new WeakMap;function Ge(e){const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",l)},o=()=>{n(S(e.result)),s()},l=()=>{r(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",l)});return T.set(t,e),t}function Je(e){if(R.has(e))return;const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",l),e.removeEventListener("abort",l)},o=()=>{n(),s()},l=()=>{r(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",l),e.addEventListener("abort",l)});R.set(e,t)}let K={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return R.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ue(e){K=e(K)}function Qe(e){return Ue().includes(e)?function(...t){return e.apply(q(this),t),S(this.request)}:function(...t){return S(e.apply(q(this),t))}}function Ze(e){return typeof e=="function"?Qe(e):(e instanceof IDBTransaction&&Je(e),F(e,Ye())?new Proxy(e,K):e)}function S(e){if(e instanceof IDBRequest)return Ge(e);if(V.has(e))return V.get(e);const t=Ze(e);return t!==e&&(V.set(e,t),T.set(t,e)),t}const q=e=>T.get(e);function et(e,t,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const l=indexedDB.open(e,t),m=S(l);return r&&l.addEventListener("upgradeneeded",a=>{r(S(l.result),a.oldVersion,a.newVersion,S(l.transaction),a)}),n&&l.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),m.then(a=>{o&&a.addEventListener("close",()=>o()),s&&a.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),m}const tt=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],$=new Map;function ne(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if($.get(t))return $.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=nt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||tt.includes(n)))return;const o=async function(l,...m){const a=this.transaction(l,s?"readwrite":"readonly");let c=a.store;return r&&(c=c.index(m.shift())),(await Promise.all([c[n](...m),s&&a.done]))[0]};return $.set(t,o),o}ue(e=>({...e,get:(t,n,r)=>ne(t,n)||e.get(t,n,r),has:(t,n)=>!!ne(t,n)||e.has(t,n)}));const ot=["continue","continuePrimaryKey","advance"],oe={},W=new WeakMap,de=new WeakMap,st={get(e,t){if(!ot.includes(t))return e[t];let n=oe[t];return n||(n=oe[t]=function(...r){W.set(this,de.get(this)[t](...r))}),n}};async function*at(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,st);for(de.set(n,t),T.set(n,q(t));t;)yield n,t=await(W.get(n)||t.continue()),W.delete(n)}function se(e,t){return t===Symbol.asyncIterator&&F(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&F(e,[IDBIndex,IDBObjectStore])}ue(e=>({...e,get(t,n,r){return se(t,n)?at:e.get(t,n,r)},has(t,n){return se(t,n)||e.has(t,n)}}));const rt=et("stock-db",1,{upgrade(e){e.objectStoreNames.contains("stocks")||e.createObjectStore("stocks",{keyPath:"id"})}});async function it(){const e=await rt;if(await e.count("stocks")>0)return await e.getAll("stocks");{const s=await(await fetch("/iKDx/"+"stocks/stocks.json")).json(),o=e.transaction("stocks","readwrite"),l=o.objectStore("stocks");for(const m of s)await l.put(m);return await o.done,s}}const ct={style:{display:"flex",gap:"8px","flex-wrap":"wrap","justify-content":"center","margin-bottom":"24px"}},lt=["onClick"],ut={key:0,style:{"margin-top":"12px"}},dt={key:0},ft={style:{"font-size":"17px","font-weight":"bold",color:"#222","margin-right":"16px","min-width":"60px"}},ht={style:{"font-size":"16px",color:"#333",flex:"1"}},pt={key:1,style:{color:"#999","text-align":"center","margin-top":"16px"}},vt={__name:"StockSearch",setup(e){const t=le("stock-search"),n=w(!1);t.on(c=>{n.value=c});const r=w(),s=w(""),o=w([]),l=["台積電","鴻海","聯發科","長榮","中鋼"];N(()=>n.value,c=>{c&&_(()=>{const f=r.value?.$el?.querySelector("input");f&&f.focus()})}),N(()=>s.value,async c=>{if(!c||c.length<1){o.value=[];return}const f=await it();o.value=f.filter(h=>h.name.includes(c)||h.id.includes(c))});function m(c){}function a(c){s.value=c,_(()=>{const f=r.value?.$el?.querySelector("input");f&&f.focus()})}return(c,f)=>(b(),Ce(P(Xe),{show:n.value,"onUpdate:show":f[1]||(f[1]=h=>P(t).emit(!1)),options:[],"cancel-text":"",style:{"--van-share-sheet-header-padding":"24px 24px 0 24px","min-height":"80vh",height:"80vh"}},{title:U(()=>f[2]||(f[2]=[g("div",{style:{"font-size":"18px","font-weight":"bold","letter-spacing":"1px","text-align":"center","margin-top":"0","margin-bottom":"0",color:"#222","line-height":"1.2"}}," 股票搜尋 ",-1)])),description:U(()=>[g("div",null,[v(P(Le),{ref_key:"searchInputRef",ref:r,modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=h=>s.value=h),placeholder:"請輸入股票名稱或代碼","action-text":"",style:{"--van-search-input-height":"48px","font-size":"18px"},onSearch:m},null,8,["modelValue"])]),g("div",null,[f[3]||(f[3]=g("div",{style:{display:"flex","align-items":"center",margin:"0 0 10px 0"}},[g("div",{style:{"margin-left":"16px","font-size":"16px",color:"#222","font-weight":"bold","letter-spacing":"1px"}}," | 熱門股票 ")],-1)),g("div",ct,[(b(),k(G,null,J(l,h=>g("span",{key:h,onClick:i=>a(h),style:_e({background:s.value===h?"#1976d2":"#e3eafc",color:s.value===h?"#fff":"#1976d2",borderRadius:"16px",padding:"4px 12px",fontSize:"15px",cursor:"pointer",userSelect:"none",fontWeight:s.value===h?"bold":"normal",boxShadow:s.value===h?"0 0 0 2px #1976d233":"none",transition:"background 0.2s, color 0.2s"})},O(h),13,lt)),64))]),s.value&&s.value.length>=1?(b(),k("div",ut,[o.value.length?(b(),k("div",dt,[(b(!0),k(G,null,J(o.value,h=>(b(),k("div",{key:h.id,style:{background:"#fff","border-radius":"12px","box-shadow":"0 2px 8px #0001",padding:"16px 20px","margin-bottom":"12px",display:"flex","align-items":"center","min-height":"56px"}},[g("div",ft,O(h.id),1),g("div",ht,O(h.name),1)]))),128))])):(b(),k("div",pt," 查無資料 "))])):Pe("",!0)])]),_:1},8,["show"]))}},mt={style:{padding:"32px"}},yt={__name:"Stock",setup(e){const t=le("stock-search");function n(){t.emit(!0)}return(r,s)=>(b(),k("div",mt,[s[0]||(s[0]=Te(" 自選股頁面324234234234234234324234234234 ",-1)),v(P(Ne),{icon:"plus",axis:"xy",magnetic:"x",gap:{x:24,y:80},style:{"--van-floating-bubble-size":"48px"},onClick:n}),v(vt)]))}};export{yt as default};
